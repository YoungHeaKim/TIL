# require
`require`를 한번하면 node process안에 `require`를 한 것을 node process단위로 저장을 해둔다.  
처음에 실행을 한번을 하고 process에 저장을 하고 두번째 `require`를 실행할때 process가 기억을 하고 있기 때문에 index.js는 한번만 실행된다.  
```js
const index = require('./index.js')
const inds = require('./index.js')
```

- - -
# WPSN REST API
## REST(Representaitonal State Transfer)
한 사람이 논문으로 만들어 발표한 것이다.  

### 설계원칙
- 클라이언트-서버 아키텍처
- 무상태(statelessness): 클라이언트의 세션 상태는 웹 서버 대신 클라이언트에 저장되어야 합니다.
- 캐시 가능: 웹 서버의 응답은, 캐시 가능 여부에 대한 정보를 포함해야 합니다.
- 계층 시스템: 클라이언트는 요청이 정확히 어느 웹 서버에 도달할 지, 중간 매체가 있는지 없는지를 모르더라도 별다른 문제없이 서비스를 사용할 수 있어야 합니다.
- 일관된 인터페이스
  - 자원은 URI를 통해서 식별하고, 자원의 제공 형태를 식별자에 포함시키지 않습니다.
  - 서버가 요청을 잘 처리할 수 있도록 각 요청은 충분한 정보를 포함하고 있어야 합니다. (Content-Type 등)
- 필요 시 코드 전송(Code on demand): 웹 서버는 자바 애플릿, 플래시, 자바스크립트 등의 제공을 통해 클라이언트의 기능을 확장시킬 수 있습니다.

### 위 설계 원칙을 따름으로써 웹 서버의 좋은 속성
- 높은 성능을 달성하기 위해서는 무상태와 캐시 가능을 사용해야 한다.  
- 확장가능성(Scalability)  
- 인터페이스의 단순함
- 웹 서버의 실시간 업데이트가 가능해지는 방법은 여러 서버에 요청을 보내고 그것이 처리될 때까지 서버를 유지를 시키고 만약 업데이트를 할 것이 있으면 다른 서버에게 요청을 하고 요청이 끝나면 서버를 내리는 형태로 만든 것이다.

## REST API
REST 원칙을 따르는 웹 API를 가지고 REST API라고 부릅니다.  

### RESTful URI 설계
REST API의 URI는 기본적으로 '자원'을 뜻한다.  
URI를 통해 자원을 표현할 때는 밑의 기본 원칙을 따른다.  
- 슬래시(/) 문자는 자원 간 계층관계를 나타내는 데 사용합니다.
- 마지막 문자로 슬래시를 포함하지 않습니다.
- 띄어쓰기를 표현할 때는 하이픈(-)을 사용하고, 밑줄(_)을 사용하지 않는다
- 대문자 대신 소문자만을 사용합니다.
- 경로에 확장자를 쓰지 않습니다. 내용 협상을 위해서는 Accept 헤더를 사용합니다.

### Document
보통 하나의 객체 혹은 데이터베이스 레코드를 나타내는 단일 자원이다.  
```
https://api.example.com/user
https://api.example.com/service-info
https://api.example.com/resource
```
컬렉션 뒤에 자원의 식별자를 붙여서 도큐먼트를 나타낼 수도 있습니다.  
```
https://api.example.com/todos/123
https://api.example.com/articles/how-to-design-rest-api
```

### Controller
자원에 대한 단순한 CRUD(Create, Read, Update, Delete)는 HTTP 메소드를 통해서 할 수 있지만, 단순 CRUD가 아닌 경우에는 자원 뒤에 동사를 붙여서 해당 동작을 표현할 수 있습니다.  
`patch`요청을 보내 `controller`를 사용하지 않을 수 있지만 patch요청은 update를 할 때는 데이터가 원하는 데이터와 다를 수 있기 때문에 지양하는 것이 좋다.  
```
https://api.example.com/todos/123/finish
```

### REST API 통신 설계
의미에 맞는 HTTP 메소드와 상태 코드를 사용해야 한다.  
컬렉션, 도큐먼트, 컨트롤러에 대해서 HTTP메소드를 아래와 같이 사용한다.  
### 컬렉션
```
# 컬렉션에 속해있는 자원을 모두 가져오기 위해 컬렉션 URI에 GET 요청을 보냅니다.
GET https://api.example.com/todos

# 컬렉션에 대한 filtering이나 pagination을 위해 쿼리 스트링을 사용할 수 있습니다.
GET https://api.example.com/todos?complete=true&assignee=me
GET https://api.example.com/todos?page=2

# 컬렉션 내에 새로운 자원을 생성하기 위해 POST 요청을 보냅니다.
POST https://api.example.com/todos
```
### 도큐먼트
```
# 단일 도큐먼트를 읽어오기 위해 도큐먼트 URI에 GET 요청을 보냅니다.
GET https://api.example.com/user
GET https://api.example.com/todos/123

# 도큐먼트를 수정하기 위해 PUT(치환) 혹은 PATCH(변경) 요청을 보냅니다.
PUT https://api.example.com/todos/123
PATCH https://api.example.com/user

# 도큐먼트를 삭제하기 위해 DELETE 요청을 보냅니다.
DELETE https://api.example.com/todos/123
```

### 이렇게 사용하면 안된다~~!!
```
# 자원의 생성을 위한 URI가 따로 존재하고 GET 메소드를 사용하는 경우
GET /add_todo?title=mytodo

# 자원 식별자를 쿼리 스트링에 포함시키는 경우
GET /todo?id=1

# 자원의 삭제를 위해 POST 메소드를 사용하는 경우
POST /todos/1/delete?id=1
```
URL을 입력할 때 자동완성기능을 만들면서 미리 get요청을 보낸다.  

- - -
# Load Balancer
클라이언트가 http 요청을 보냈을때 Load Balance는 수많은 서버 들 중 일을 하지않는 서버를 찾아내서 요청을 보내는 일을 해주는 기능을 한다.  

## Sticky Session
서버 하나만을 사용할 수 있게 만드는 요청  

# Content Negotiation(내용 협상)
`accept`와 `Content-Type`을 사용하여 똑같은 URI로 다른 자원을 받아 올 수 있다.  

- - -
# REPL
Read-Evaluate-Print-Loop로 써 터미널에서 node를 친 후 안에 사용을 해야한다.  
```
node

query = require('./src/index.js')
```

- - -
# API 설계시 확인 방법
1. REPL에서 데이터를 생성해준다.  
2. POSTMAN을 켠 후 url을 작성한 후 확인한다.(이때 서버를 실행시켜야 한다.)  
